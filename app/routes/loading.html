{% extends 'base.html' %}

{% block title %}트래픽 데이터 수집 중{% endblock %}

{% block content %}
<div class="container mt-5">
    <div class="text-center">
        <div class="spinner-border text-primary" role="status" style="width: 3rem; height: 3rem;">
            <span class="visually-hidden">Loading...</span>
        </div>
        <h2 class="mt-3">트래픽 데이터를 수집하고 있습니다.</h2>
        <p class="text-muted">이 작업은 몇 분 정도 소요될 수 있습니다. 잠시만 기다려 주세요...</p>
    </div>
</div>

<script>
document.addEventListener("DOMContentLoaded", function() {
    // AJAX call to start the data generation
    fetch("{{ url_for('sar_traffic.generate_run') }}")
        .then(response => {
            // When the server responds, redirect to the index page.
            // The response from generate_run is a redirect, but fetch API doesn't follow it automatically.
            // So we manually redirect the user.
            window.location.href = "{{ url_for('sar_traffic.index') }}";
        })
        .catch(error => {
            console.error('Error:', error);
            alert('데이터를 가져오는 중 오류가 발생했습니다.');
            window.location.href = "{{ url_for('sar_traffic.index') }}";
        });
});
</script>
{% endblock %}
